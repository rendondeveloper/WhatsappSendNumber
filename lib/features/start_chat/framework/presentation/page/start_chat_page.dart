import 'dart:io';import 'package:flutter/material.dart';import 'package:flutter/services.dart';import 'package:flutter_riverpod/flutter_riverpod.dart';import 'package:url_launcher/url_launcher.dart';import 'package:whatsappsendnumber/core/analitycs/analytics_constants.dart';import 'package:whatsappsendnumber/features/start_chat/framework/di/send_message_di.dart';import 'package:whatsappsendnumber/features/start_chat/framework/presentation/page/ui_models/start_chat_state.dart';import 'package:whatsappsendnumber/resources/dimens_app.dart';import 'package:whatsappsendnumber/resources/extensions/extension_context.dart';import 'package:whatsappsendnumber/resources/strings_app.dart';class SendMessagePage extends ConsumerWidget {  final _formKey = GlobalKey<FormState>();  final _phoneNumberController = TextEditingController();  SendMessagePage({super.key});  @override  Widget build(BuildContext context, WidgetRef ref) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        Container(          margin: const EdgeInsets.symmetric(horizontal: doubleSeparation),          width: MediaQuery.of(context).orientation == Orientation.portrait              ? MediaQuery.of(context).size.width              : MediaQuery.of(context).size.width * .80,          child: Row(            mainAxisAlignment: MainAxisAlignment.start,            crossAxisAlignment: CrossAxisAlignment.start,            children: [              Expanded(                  flex: 1,                  child: StreamBuilder(                      stream: ref.watch(sendMessageProvider.notifier).stream,                      builder: (context, snapshot) {                        final state = snapshot.hasData ? (snapshot.data as StartChatState) : const StartChatState();                        return Container(                            padding: const EdgeInsets.symmetric(vertical: 20.0, horizontal: simpleSmallSeparation),                            decoration: BoxDecoration(                                border: Border.all( color: Theme.of(context).errorColor, width: 0.8,),                                borderRadius: const BorderRadius.all(Radius.circular(radiusBig))),                            child: Center(                              child: Text(                                state.country.code,                                style: Theme.of(context).textTheme.titleMedium?.copyWith(color: Theme.of(context).errorColor),                                textAlign: TextAlign.center,                              ),                            ));                      })),              const SizedBox(width: simpleSmallSeparation),              Expanded(                flex: 6,                child: Form(                    key: _formKey,                    child: TextFormField(                      controller: _phoneNumberController,                      keyboardType: TextInputType.phone,                      textAlign: TextAlign.start,                      textInputAction: TextInputAction.done,                      maxLength: 10,                      maxLines: 1,                      inputFormatters: <TextInputFormatter>[FilteringTextInputFormatter.digitsOnly],                      validator: (value) {                        if (value == null || value.length < 10) {                          ref.read(sendMessageProvider.notifier).onEvent(AnalyticsConstants.pageTabSendMessageErrorWriteNumber);                          return context.strings().sendMessagePageInputPhoneError;                        }                        return null;                      },                      decoration: InputDecoration(                        counter: const Offstage(),                        hintText: context.strings().sendMessagePageInputPhone,                        border: OutlineInputBorder(                          borderRadius: BorderRadius.circular(radiusBig),                        ),                      ),                    )),              ),            ],          ),        ),        const SizedBox(height: doubleSeparation),        Container(          margin: const EdgeInsets.symmetric(horizontal: doubleSeparation),          width: MediaQuery.of(context).orientation == Orientation.portrait              ? MediaQuery.of(context).size.width              : MediaQuery.of(context).size.width * .80,          child: ElevatedButton(            onPressed: () {              if (_formKey.currentState!.validate()) {                ref.read(sendMessageProvider.notifier).onEvent(AnalyticsConstants.pageTabSendMessageOpenChat);                ref.read(sendMessageProvider.notifier).saveNumberPhone(_phoneNumberController.text);                launch("${Platform.isAndroid ? urlAppApiWhatsapp : urlAppApiWhatsappIOS}${_phoneNumberController.text}");                FocusScope.of(context).unfocus();                _phoneNumberController.clear();              }            },            child: Text(context.strings().sendMessagePageButtonSendStartChat),          ),        ),      ],    );  }}